# 大型网站架构演化历程

## 初始阶段

应用程序+数据库+文件=一台服务器

## 应用服务于数据服务分类

应用服务器+文件服务器+数据库服务器

## 缓存

两种缓存：

1. 本地缓存

   优点：速度快

   缺点：容量有限

2. 缓存服务器

   优点：容量大，可扩容

   缺点：速度相对慢

## 使用应用服务器缓存

通过负载均衡调度。

实现系统可升缩性，简单成熟。

## 数据库读写分离

主从数据库。

## 使用反向代理和CDN

区别：

CDN在运营提供商的机房内。

反向代理在网站机房内。

## 使用分布式文件系统和分布式数据库

分布式数据库是网站数据库拆分的最后手段，更常用的数据库拆分手段是业务分库，将不同业务数据库部署在不同的物理服务器上。

## 使用NoSQL和搜索引擎

应用服务器通过一个统一数据访问模块访问各种数据。

## 业务拆分

拆分成不同的产品线

拆分成不同的应用

通过超链接建立关系、通过消息队列就行数据分发、通过访问同一个数据存储系统构成一个关联的完整系统。

## 分布式服务

将共用的业务提取出来，独立部署，有这些可复用的业务连接数据库，提供共用业务服务。

# 大型网站架构模式

## 分层

分层是逻辑上，不是物理上的。横向方面切分。

##  分割

纵向方面切分

## 分布式

1. 分布式应用和服务
2. 分布式静态资源
3. 分布式数据和存储
4. 分布式计算

## 集群

更好的并发特性、可用性

## 缓存

前提：

1. 数据访问热点不均衡
2. 数据有有效期

## 异步

生产者-消费者模型

1. 提高系统可用性
2. 加快网站响应速度
3. 消除并发访问高峰

## 冗余

集群

## 自动化

主要集中在发布运维方面

## 安全

# 大型网站核心架构要素

架构：最高层次的规划，难以改变的决定。

软件架构五要素：==性能、可用性、伸缩性、扩展性、安全性==

## 性能

很多时候，性能问题是网站架构升级优化的触发器。

提高方法：

- 浏览器：浏览器缓存、页面压缩、合理布局页面、减少Cookie传输
- 使用CDN
- 应用服务器端使用本地缓存和分布式缓存
- 通过异步操作将用户请求发送至消息队列等待后续任务处理
- 多台应用服务器组成集群
- 代码通过多线程、改善内存管理
- 数据库索引、缓存、SQL优化；NoSQL。

性能指标：

- 响应时间
- TPS
- 系统性能计数器

## 可用性

高可用性架构设计的前提：必然会出现服务器宕机，高可用性设计的目标是当服务器宕机后，服务或者应用仍然可用。

主要手段：==冗余==

- 应用服务器：组成集群（前提：应用服务器上不能保存请求的会话信息）
- 存储服务器：对数据实时备份
- 软件开发：过程保证质量（预发布验证、自动化测试、自动化发布、灰度发布）

## 伸缩性

指通过不断向集群中增加服务器的手段来缓解不断上升的用户并发访问压力和不断增长的数据存储需求。

衡量指标：

- 是否可以用多台服务器构建集群
- 是否容易向集群中添加新的服务器
- 加入新的服务器后是否可以提供和原来的服务器无差别的服务
- 集群中可容纳的总的服务器数量是否有限制

1. 应用服务器集群：只要服务器上不保存数据，通过使用合适的负载均衡设备就可以不断向集训加入服务器
2. 缓存服务器集群：新加入的服务器可能会导致缓存路由失效，进而导致集群中大部分缓存数据都无法访问。需改进路由缓存路由算法保证缓存数据的可访问性。
3. 关系数据库：很难做到大规模集群的可升缩性。必须在数据库外实现，通过路由分区等手段将部署有多个数据库的服务器组成一个集群。
4. NoSQL天生对可伸缩性的支持都非常好。

## 扩展性

目的：网站的架构能够快速响应需求变化

指标：网站增加新的业务产品时，是否可以实现对现有产品透明无影响，不做或很少改动就可上线。

手段：

- 时间驱动架构

  通常利用消息队列实现，将用户请求和其他业务事件构成消息发布队列，消息的处理者作为消费者从消息队列总获取消息进行处理。

- 分布式服务

  将业务和可复用服务分离开来，通分布式服务框架调用。新增产品通过先用可复用的服务实现自身的业务逻辑。

## 安全性

衡量标准：针对现存和潜在的各种攻击和窃密手段，是否有可靠的应对策略。

